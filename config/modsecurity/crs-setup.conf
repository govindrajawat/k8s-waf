# OWASP ModSecurity Core Rule Set (CRS) configuration file

# ------------------------------------------------------------------------
# OWASP ModSecurity Core Rule Set ver.3.4.0
# Copyright (c) 2006-2022 Trustwave and contributors. All rights reserved.
# Copyright (c) 2021-2022 Core Rule Set project. All rights reserved.
#
# The OWASP ModSecurity Core Rule Set is distributed under
# Apache Software License (ASL) version 2
# Please see the enclosed LICENSE file for full details.
# ------------------------------------------------------------------------

#
# -- [[ Configuration ]] -------------------------------------------------
#
# The CRS assumes that you have followed the official ModSecurity
# installation instructions for your operating system / platform.
# It also assumes that you have included the recommended configuration
# directives from the modsecurity.conf-recommended file.
#
# The CRS configuration is split into multiple files to make it easier
# to understand and maintain.
#
# The files are included in the following order:
#
# 1. crs-setup.conf.example (this file)
# 2. rules/*.conf
#
# ------------------------------------------------------------------------

# ------------------------------------------------------------------------
# -- [[ Core Rule Set Configuration ]] ------------------------------------
# ------------------------------------------------------------------------

# SecRuleEngine On
# SecRequestBodyAccess On
# SecResponseBodyAccess On
# SecResponseBodyMimeType text/plain text/html text/xml
# SecResponseBodyLimit 524288
# SecResponseBodyLimitAction ProcessPartial
# SecTmpDir /tmp/
# SecDataDir /tmp/
# SecUploadDir /tmp/
# SecUploadKeepFiles Off
# SecDebugLog /var/log/modsec_debug.log
# SecDebugLogLevel 0
# SecAuditEngine RelevantOnly
# SecAuditLogRelevantStatus "^(?:5|4(?!04))"
# SecAuditLogParts ABIJDEFHZ
# SecAuditLogType Serial
# SecAuditLog /var/log/modsec_audit.log
# SecArgumentSeparator &
# SecCookieFormat 0
# SecUnicodeMapFile unicode.mapping 20127
# SecStatusEngine Off

# ------------------------------------------------------------------------
# -- [[ Project Honeypot HTTP Blacklist ]] -------------------------------
# ------------------------------------------------------------------------

# Enable the Project Honeypot HTTP Blacklist module.
# To use this, you need to register for an API key and set it below.
# See https://www.projecthoneypot.org/httpbl_api.php for more info.

# SecHttpBlKey XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
# SecAction "id:900500,\
#   phase:1,\
#   nolog,\
#   pass,\
#   t:none,\
#   setvar:tx.block_search_ip=1,\
#   setvar:tx.block_suspicious_ip=1,\
#   setvar:tx.block_harvester_ip=1,\
#   setvar:tx.block_spammer_ip=1"

# ------------------------------------------------------------------------
# -- [[ GeoIP Database ]] ------------------------------------------------
# ------------------------------------------------------------------------

# Enable the GeoIP database module.
# To use this, you need to download the GeoIP database from MaxMind.
# See https://dev.maxmind.com/geoip/geoip2/geolite2/ for more info.

# SecGeoLookupDb /path/to/GeoLite2-Country.mmdb
# SecAction "id:900600,\
#   phase:1,\
#   nolog,\
#   pass,\
#   t:none,\
#   setvar:tx.geoip_enabled=1"

# ------------------------------------------------------------------------
# -- [[ Anti-Automation / DoS Protection ]] ------------------------------
# ------------------------------------------------------------------------

# Enable the Anti-Automation / DoS protection module.
# This module provides protection against automated clients and DoS attacks.

SecAction "id:900700,\
  phase:1,\
  nolog,\
  pass,\
  t:none,\
  setvar:tx.dos_burst_time_slice=60,\
  setvar:tx.dos_counter_threshold=100,\
  setvar:tx.dos_block_timeout=600"

# ------------------------------------------------------------------------
# -- [[ HTTP Policy Settings ]] -------------------------------------------
# ------------------------------------------------------------------------

# Configure the allowed HTTP versions, methods, and headers.

SecAction "id:900800,\
  phase:1,\
  nolog,\
  pass,\
  t:none,\
  setvar:tx.allowed_http_versions=HTTP/1.0 HTTP/1.1 HTTP/2 HTTP/2.0,\
  setvar:tx.allowed_methods=GET HEAD POST OPTIONS,\
  setvar:tx.allowed_request_content_type=application/x-www-form-urlencoded|multipart/form-data|text/xml|application/xml|application/x-amf|application/json,\
  setvar:tx.allowed_request_content_type_charset=utf-8|iso-8859-1|iso-8859-15|windows-1252,\
  setvar:tx.restricted_extensions=.asa/ .asax/ .ascx/ .axd/ .backup/ .bak/ .bat/ .cdx/ .cer/ .cfg/ .cmd/ .com/ .config/ .conf/ .cs/ .csproj/ .csr/ .dat/ .db/ .dbf/ .dll/ .dos/ .htr/ .htw/ .ida/ .idc/ .idq/ .inc/ .ini/ .key/ .licx/ .lnk/ .log/ .mdb/ .old/ .pass/ .pdb/ .pol/ .printer/ .pwd/ .resources/ .resx/ .sql/ .sys/ .vb/ .vbs/ .vbproj/ .vsdisco/ .webinfo/ .xsd/ .xsx,\
  setvar:tx.restricted_headers=/proxy/ /lock-token/ /content-range/ /if/"

# ------------------------------------------------------------------------
# -- [[ Anomaly Scoring Mode ]] ------------------------------------------
# ------------------------------------------------------------------------

# Configure the anomaly scoring mode.
# In this mode, each rule will increment an anomaly score when it matches.
# The scores are then evaluated at the end of the phase.

SecAction "id:900900,\
  phase:1,\
  nolog,\
  pass,\
  t:none,\
  setvar:tx.anomaly_score_threshold=5,\
  setvar:tx.paranoia_level=1,\
  setvar:tx.executing_paranoia_level=1,\
  setvar:tx.sql_injection_score=5,\
  setvar:tx.xss_score=4,\
  setvar:tx.rfi_score=5,\
  setvar:tx.lfi_score=5,\
  setvar:tx.rce_score=5,\
  setvar:tx.php_injection_score=5,\
  setvar:tx.http_violation_score=4,\
  setvar:tx.session_fixation_score=5,\
  setvar:tx.inbound_anomaly_score_threshold=5,\
  setvar:tx.outbound_anomaly_score_threshold=4"

# ------------------------------------------------------------------------
# -- [[ End of Configuration ]] -------------------------------------------
# ------------------------------------------------------------------------